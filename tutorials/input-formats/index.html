<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="chase mateusiak <chasem@wustl.edu>, michael brent <brent@wustl.edu>" /><link rel="canonical" href="https://brentlab.github.io/tfbpmodeling/tutorials/input-formats/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Input Data Formats - tfbpmodeling</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Input Data Formats";
        var mkdocs_page_input_path = "tutorials/input-formats.md";
        var mkdocs_page_url = "/tfbpmodeling/tutorials/input-formats/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> tfbpmodeling
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/quickstart/">Quick Start</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CLI Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cli/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cli/linear-perturbation-binding-modeling/">linear_perturbation_binding_modeling</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../basic-workflow/">Basic Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced-features/">Advanced Features</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Input Data Formats</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#response-file-format">Response File Format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-types">Data Types</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#predictors-file-format">Predictors File Format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#structure_1">Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#requirements_1">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-types_1">Data Types</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#gene-identifier-consistency">Gene Identifier Consistency</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#critical-requirements">Critical Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#common-gene-id-formats">Common Gene ID Formats</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#handling-id-mismatches">Handling ID Mismatches</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#blacklist-file-format">Blacklist File Format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#structure_2">Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#use-cases">Use Cases</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creating-blacklist-files">Creating Blacklist Files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-quality-checks">Data Quality Checks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#automated-validation">Automated Validation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#manual-quality-assessment">Manual Quality Assessment</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-data-preparation-workflow">Example Data Preparation Workflow</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#complete-pipeline">Complete Pipeline</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#common-issues-and-solutions">Common Issues and Solutions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#issue-1-gene-id-mismatches">Issue 1: Gene ID Mismatches</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#issue-2-missing-values">Issue 2: Missing Values</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#issue-3-scale-differences">Issue 3: Scale Differences</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Core Modules</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/interface/">interface</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/modeling_input_data/">modeling_input_data</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/bootstrapped_input_data/">bootstrapped_input_data</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/bootstrap_model_results/">bootstrap_model_results</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Evaluation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/interactor_significance_results/">interactor_significance_results</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/evaluate_interactor_significance_lassocv/">evaluate_interactor_significance_lassocv</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/evaluate_interactor_significance_linear/">evaluate_interactor_significance_linear</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Cross-Validation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/stratified_cv/">stratified_cv</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/stratified_cv_r2/">stratified_cv_r2</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../development/contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../development/testing/">Testing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">tfbpmodeling</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tutorials</li>
      <li class="breadcrumb-item active">Input Data Formats</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/brentlab/tfbpmodeling/edit/main/docs/tutorials/input-formats.md">Edit on tfbpmodeling</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="input-data-formats">Input Data Formats<a class="headerlink" href="#input-data-formats" title="Permanent link">&para;</a></h1>
<p>This guide provides detailed specifications for preparing input data for tfbpmodeling analysis.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>tfbpmodeling requires two main input files plus optional supplementary files:</p>
<ol>
<li><strong>Response File</strong>: Gene expression data (dependent variable)</li>
<li><strong>Predictors File</strong>: Transcription factor binding data (independent variables)</li>
<li><strong>Blacklist File</strong> (optional): Features to exclude from analysis</li>
</ol>
<h2 id="response-file-format">Response File Format<a class="headerlink" href="#response-file-format" title="Permanent link">&para;</a></h2>
<h3 id="structure">Structure<a class="headerlink" href="#structure" title="Permanent link">&para;</a></h3>
<p>The response file contains gene expression measurements:</p>
<div class="highlight"><pre><span></span><code>gene_id,sample_1,sample_2,sample_3,sample_4,YPD1
YBR001C,0.234,-1.456,0.876,-0.123,0.543
YBR002W,-0.456,0.123,1.234,-0.567,-0.234
YBR003W,1.234,0.567,-0.234,0.876,0.123
YBR004C,-0.123,-0.876,0.456,0.234,-0.456
</code></pre></div>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Element</th>
<th>Requirement</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Format</strong></td>
<td>CSV with comma separators</td>
<td>Standard comma-separated values</td>
</tr>
<tr>
<td><strong>First Column</strong></td>
<td>Gene identifiers</td>
<td>Must match predictor file exactly</td>
</tr>
<tr>
<td><strong>Header Row</strong></td>
<td>Sample names + perturbed TF</td>
<td>Column names for each measurement</td>
</tr>
<tr>
<td><strong>Data Cells</strong></td>
<td>Numeric values</td>
<td>Expression measurements (log2 fold-change, z-scores, etc.)</td>
</tr>
<tr>
<td><strong>Perturbed TF Column</strong></td>
<td>Must be present</td>
<td>Column name must match <code>--perturbed_tf</code> parameter</td>
</tr>
</tbody>
</table>
<h3 id="data-types">Data Types<a class="headerlink" href="#data-types" title="Permanent link">&para;</a></h3>
<p><strong>Supported expression data types</strong>:
- Log2 fold-change values
- Z-scores or standardized values
- Raw expression values (will be normalized if needed)
- Differential expression statistics</p>
<p><strong>Example expression data preparation</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Load raw expression data</span>
<span class="n">raw_expr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;raw_expression.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calculate log2 fold-change vs control</span>
<span class="n">control_samples</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ctrl_1&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_2&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl_3&#39;</span><span class="p">]</span>
<span class="n">treatment_samples</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;treat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_3&#39;</span><span class="p">]</span>

<span class="n">control_mean</span> <span class="o">=</span> <span class="n">raw_expr</span><span class="p">[</span><span class="n">control_samples</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">treatment_mean</span> <span class="o">=</span> <span class="n">raw_expr</span><span class="p">[</span><span class="n">treatment_samples</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">log2fc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">treatment_mean</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">control_mean</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create response file</span>
<span class="n">response_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sample_1&#39;</span><span class="p">:</span> <span class="n">log2fc</span><span class="p">,</span>
    <span class="s1">&#39;sample_2&#39;</span><span class="p">:</span> <span class="n">log2fc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">log2fc</span><span class="p">)),</span>
    <span class="s1">&#39;YPD1&#39;</span><span class="p">:</span> <span class="n">log2fc</span>  <span class="c1"># Perturbed TF response</span>
<span class="p">})</span>

<span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;gene_id&#39;</span>
<span class="n">response_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;response_data.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="predictors-file-format">Predictors File Format<a class="headerlink" href="#predictors-file-format" title="Permanent link">&para;</a></h2>
<h3 id="structure_1">Structure<a class="headerlink" href="#structure_1" title="Permanent link">&para;</a></h3>
<p>The predictors file contains transcription factor binding data:</p>
<div class="highlight"><pre><span></span><code>gene_id,TF_1,TF_2,TF_3,TF_4,YPD1_binding
YBR001C,0.123,0.456,0.789,0.012,0.345
YBR002W,0.234,0.567,0.890,0.123,0.456
YBR003W,0.345,0.678,0.901,0.234,0.567
YBR004C,0.456,0.789,0.012,0.345,0.678
</code></pre></div>
<h3 id="requirements_1">Requirements<a class="headerlink" href="#requirements_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Element</th>
<th>Requirement</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Format</strong></td>
<td>CSV with comma separators</td>
<td>Standard comma-separated values</td>
</tr>
<tr>
<td><strong>First Column</strong></td>
<td>Gene identifiers</td>
<td>Must match response file exactly</td>
</tr>
<tr>
<td><strong>Header Row</strong></td>
<td>TF names</td>
<td>Transcription factor identifiers</td>
</tr>
<tr>
<td><strong>Data Cells</strong></td>
<td>Numeric values 0-1</td>
<td>Binding probabilities or normalized scores</td>
</tr>
<tr>
<td><strong>No Missing Values</strong></td>
<td>Complete data required</td>
<td>All cells must contain numeric values</td>
</tr>
</tbody>
</table>
<h3 id="data-types_1">Data Types<a class="headerlink" href="#data-types_1" title="Permanent link">&para;</a></h3>
<p><strong>Supported binding data types</strong>:
- ChIP-seq binding probabilities (0-1)
- Normalized binding scores (0-1)
- Peak presence indicators (0/1)
- Binding strength quantiles (0-1)</p>
<p><strong>Example binding data preparation</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="c1"># Load ChIP-seq peak scores</span>
<span class="n">chip_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;chip_peaks.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Normalize to 0-1 range</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">normalized_binding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">chip_data</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">chip_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">chip_data</span><span class="o">.</span><span class="n">columns</span>
<span class="p">)</span>

<span class="c1"># Save as predictors file</span>
<span class="n">normalized_binding</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;gene_id&#39;</span>
<span class="n">normalized_binding</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;binding_data.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="gene-identifier-consistency">Gene Identifier Consistency<a class="headerlink" href="#gene-identifier-consistency" title="Permanent link">&para;</a></h2>
<h3 id="critical-requirements">Critical Requirements<a class="headerlink" href="#critical-requirements" title="Permanent link">&para;</a></h3>
<p>Both files <strong>must</strong> use identical gene identifiers:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Verify gene ID consistency</span>
<span class="n">response_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;response.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">predictor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;predictors.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Check for exact matches</span>
<span class="n">common_genes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">response_only</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">predictor_only</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Common genes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response only: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response_only</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predictor only: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">predictor_only</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="common-gene-id-formats">Common Gene ID Formats<a class="headerlink" href="#common-gene-id-formats" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Format</th>
<th>Example</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Systematic names</strong></td>
<td>YBR001C</td>
<td>S. cerevisiae standard</td>
</tr>
<tr>
<td><strong>Gene symbols</strong></td>
<td>CDC42</td>
<td>Human/mouse standard</td>
</tr>
<tr>
<td><strong>Ensembl IDs</strong></td>
<td>ENSG00000123456</td>
<td>Cross-species compatible</td>
</tr>
<tr>
<td><strong>RefSeq IDs</strong></td>
<td>NM_001234567</td>
<td>NCBI standard</td>
</tr>
</tbody>
</table>
<h3 id="handling-id-mismatches">Handling ID Mismatches<a class="headerlink" href="#handling-id-mismatches" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Align gene IDs between files</span>
<span class="k">def</span><span class="w"> </span><span class="nf">align_gene_ids</span><span class="p">(</span><span class="n">response_df</span><span class="p">,</span> <span class="n">predictor_df</span><span class="p">):</span>
    <span class="c1"># Find common genes</span>
    <span class="n">common_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

    <span class="c1"># Subset both dataframes</span>
    <span class="n">aligned_response</span> <span class="o">=</span> <span class="n">response_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_genes</span><span class="p">]</span>
    <span class="n">aligned_predictor</span> <span class="o">=</span> <span class="n">predictor_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_genes</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">aligned_response</span><span class="p">,</span> <span class="n">aligned_predictor</span>

<span class="c1"># Apply alignment</span>
<span class="n">aligned_response</span><span class="p">,</span> <span class="n">aligned_predictor</span> <span class="o">=</span> <span class="n">align_gene_ids</span><span class="p">(</span><span class="n">response_df</span><span class="p">,</span> <span class="n">predictor_df</span><span class="p">)</span>

<span class="c1"># Save aligned files</span>
<span class="n">aligned_response</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;aligned_response.csv&#39;</span><span class="p">)</span>
<span class="n">aligned_predictor</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;aligned_predictors.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="blacklist-file-format">Blacklist File Format<a class="headerlink" href="#blacklist-file-format" title="Permanent link">&para;</a></h2>
<h3 id="structure_2">Structure<a class="headerlink" href="#structure_2" title="Permanent link">&para;</a></h3>
<p>Simple text file with one gene identifier per line:</p>
<div class="highlight"><pre><span></span><code>YBR999W
YCR888X
ribosomal_protein_L1
housekeeping_gene_1
batch_effect_gene
</code></pre></div>
<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<p><strong>Common genes to blacklist</strong>:
- Housekeeping genes with stable expression
- Ribosomal protein genes
- Mitochondrial genes
- Known batch effect genes
- Genes with technical artifacts</p>
<h3 id="creating-blacklist-files">Creating Blacklist Files<a class="headerlink" href="#creating-blacklist-files" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Identify housekeeping genes</span>
<span class="n">housekeeping_genes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ACT1&#39;</span><span class="p">,</span> <span class="s1">&#39;TUB1&#39;</span><span class="p">,</span> <span class="s1">&#39;TUB2&#39;</span><span class="p">,</span> <span class="s1">&#39;RDN18-1&#39;</span><span class="p">,</span> <span class="s1">&#39;RDN25-1&#39;</span>
<span class="p">]</span>

<span class="c1"># Identify low-variance genes</span>
<span class="n">low_variance_genes</span> <span class="o">=</span> <span class="n">response_df</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Combine blacklists</span>
<span class="n">blacklist_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">housekeeping_genes</span> <span class="o">+</span> <span class="n">low_variance_genes</span><span class="p">))</span>

<span class="c1"># Save blacklist</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;blacklist.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blacklist_genes</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gene</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="data-quality-checks">Data Quality Checks<a class="headerlink" href="#data-quality-checks" title="Permanent link">&para;</a></h2>
<h3 id="automated-validation">Automated Validation<a class="headerlink" href="#automated-validation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_input_data</span><span class="p">(</span><span class="n">response_file</span><span class="p">,</span> <span class="n">predictor_file</span><span class="p">,</span> <span class="n">perturbed_tf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate input data format and consistency.&quot;&quot;&quot;</span>

    <span class="c1"># Load data</span>
    <span class="n">response_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">response_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">predictor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">predictor_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Check 1: File formats</span>
    <span class="k">assert</span> <span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gene_id&#39;</span><span class="p">,</span> <span class="s2">&quot;Response file must have &#39;gene_id&#39; as index&quot;</span>
    <span class="k">assert</span> <span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gene_id&#39;</span><span class="p">,</span> <span class="s2">&quot;Predictor file must have &#39;gene_id&#39; as index&quot;</span>

    <span class="c1"># Check 2: Perturbed TF presence</span>
    <span class="k">assert</span> <span class="n">perturbed_tf</span> <span class="ow">in</span> <span class="n">response_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Perturbed TF &#39;</span><span class="si">{</span><span class="n">perturbed_tf</span><span class="si">}</span><span class="s2">&#39; not found in response&quot;</span>

    <span class="c1"># Check 3: Gene ID overlap</span>
    <span class="n">common_genes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Too few common genes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Check 4: Data types</span>
    <span class="k">assert</span> <span class="n">response_df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">predictor_df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># Check 5: Missing values</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">response_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;Response data contains missing values&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">predictor_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;Predictor data contains missing values&quot;</span>

    <span class="c1"># Check 6: Value ranges</span>
    <span class="n">predictor_ranges</span> <span class="o">=</span> <span class="n">predictor_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">predictor_ranges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Some predictor values are negative&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">predictor_ranges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Some predictor values exceed 1&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ All validation checks passed&quot;</span><span class="p">)</span>

<span class="c1"># Run validation</span>
<span class="n">validate_input_data</span><span class="p">(</span><span class="s1">&#39;response.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;predictors.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;YPD1&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="manual-quality-assessment">Manual Quality Assessment<a class="headerlink" href="#manual-quality-assessment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Data exploration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">explore_data</span><span class="p">(</span><span class="n">response_file</span><span class="p">,</span> <span class="n">predictor_file</span><span class="p">):</span>
    <span class="n">response_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">response_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">predictor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">predictor_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Response Data ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">response_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value range: [</span><span class="si">{</span><span class="n">response_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">response_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing values: </span><span class="si">{</span><span class="n">response_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Predictor Data ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">...&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value range: [</span><span class="si">{</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing values: </span><span class="si">{</span><span class="n">predictor_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plot distributions</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Response distribution</span>
    <span class="n">response_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Response Data Distribution&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Expression Values&#39;</span><span class="p">)</span>

    <span class="c1"># Predictor distribution</span>
    <span class="n">predictor_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predictor Data Distribution&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Binding Values&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;data_distributions.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Explore your data</span>
<span class="n">explore_data</span><span class="p">(</span><span class="s1">&#39;response.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;predictors.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="example-data-preparation-workflow">Example Data Preparation Workflow<a class="headerlink" href="#example-data-preparation-workflow" title="Permanent link">&para;</a></h2>
<h3 id="complete-pipeline">Complete Pipeline<a class="headerlink" href="#complete-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prepare_tfbp_data</span><span class="p">(</span><span class="n">raw_expression_file</span><span class="p">,</span> <span class="n">raw_binding_file</span><span class="p">,</span>
                      <span class="n">perturbed_tf</span><span class="p">,</span> <span class="n">output_prefix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete data preparation pipeline.&quot;&quot;&quot;</span>

    <span class="c1"># 1. Load raw data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading raw data...&quot;</span><span class="p">)</span>
    <span class="n">expr_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">raw_expression_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">binding_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">raw_binding_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 2. Process expression data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing expression data...&quot;</span><span class="p">)</span>
    <span class="c1"># Log-transform if needed</span>
    <span class="k">if</span> <span class="n">expr_raw</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">expr_processed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">expr_raw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expr_processed</span> <span class="o">=</span> <span class="n">expr_raw</span>

    <span class="c1"># Add perturbed TF column (example: mean of treatment samples)</span>
    <span class="k">if</span> <span class="n">perturbed_tf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expr_processed</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Calculate as mean expression change</span>
        <span class="n">expr_processed</span><span class="p">[</span><span class="n">perturbed_tf</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_processed</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># 3. Process binding data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing binding data...&quot;</span><span class="p">)</span>
    <span class="c1"># Normalize to 0-1 range</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">binding_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">binding_raw</span><span class="p">),</span>
        <span class="n">index</span><span class="o">=</span><span class="n">binding_raw</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">binding_raw</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">)</span>

    <span class="c1"># 4. Align gene IDs</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aligning gene identifiers...&quot;</span><span class="p">)</span>
    <span class="n">common_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">expr_processed</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">binding_processed</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Common genes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">expr_aligned</span> <span class="o">=</span> <span class="n">expr_processed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_genes</span><span class="p">]</span>
    <span class="n">binding_aligned</span> <span class="o">=</span> <span class="n">binding_processed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_genes</span><span class="p">]</span>

    <span class="c1"># 5. Quality checks</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running quality checks...&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Insufficient gene overlap&quot;</span>
    <span class="k">assert</span> <span class="n">perturbed_tf</span> <span class="ow">in</span> <span class="n">expr_aligned</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;Perturbed TF missing&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">expr_aligned</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;Missing expression data&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">binding_aligned</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;Missing binding data&quot;</span>

    <span class="c1"># 6. Save processed data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving processed data...&quot;</span><span class="p">)</span>
    <span class="n">expr_aligned</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;gene_id&#39;</span>
    <span class="n">binding_aligned</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;gene_id&#39;</span>

    <span class="n">expr_aligned</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s1">_response.csv&#39;</span><span class="p">)</span>
    <span class="n">binding_aligned</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s1">_predictors.csv&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Data preparation complete!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Response file: </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">_response.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Predictors file: </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">_predictors.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Genes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_genes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Expression samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">expr_aligned</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  TF predictors: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">binding_aligned</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run preparation</span>
<span class="n">prepare_tfbp_data</span><span class="p">(</span>
    <span class="n">raw_expression_file</span><span class="o">=</span><span class="s1">&#39;raw_expression.csv&#39;</span><span class="p">,</span>
    <span class="n">raw_binding_file</span><span class="o">=</span><span class="s1">&#39;raw_binding.csv&#39;</span><span class="p">,</span>
    <span class="n">perturbed_tf</span><span class="o">=</span><span class="s1">&#39;YPD1&#39;</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="o">=</span><span class="s1">&#39;processed&#39;</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="common-issues-and-solutions">Common Issues and Solutions<a class="headerlink" href="#common-issues-and-solutions" title="Permanent link">&para;</a></h2>
<h3 id="issue-1-gene-id-mismatches">Issue 1: Gene ID Mismatches<a class="headerlink" href="#issue-1-gene-id-mismatches" title="Permanent link">&para;</a></h3>
<p><strong>Problem</strong>: Gene IDs don't match between files</p>
<p><strong>Solution</strong>: Use gene ID mapping:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Load ID mapping</span>
<span class="n">id_mapping</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;gene_id_mapping.csv&#39;</span><span class="p">)</span>  <span class="c1"># old_id, new_id</span>
<span class="n">mapping_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">id_mapping</span><span class="p">[</span><span class="s1">&#39;old_id&#39;</span><span class="p">],</span> <span class="n">id_mapping</span><span class="p">[</span><span class="s1">&#39;new_id&#39;</span><span class="p">]))</span>

<span class="c1"># Apply mapping</span>
<span class="n">response_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping_dict</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">response_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre></div>
<h3 id="issue-2-missing-values">Issue 2: Missing Values<a class="headerlink" href="#issue-2-missing-values" title="Permanent link">&para;</a></h3>
<p><strong>Problem</strong>: Missing data in binding matrix</p>
<p><strong>Solution</strong>: Impute or filter:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Option 1: Remove genes with missing binding data</span>
<span class="n">complete_genes</span> <span class="o">=</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
<span class="n">response_df</span> <span class="o">=</span> <span class="n">response_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_genes</span><span class="p">]</span>
<span class="n">binding_df</span> <span class="o">=</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_genes</span><span class="p">]</span>

<span class="c1"># Option 2: Impute missing values</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">binding_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">binding_df</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">binding_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">binding_df</span><span class="o">.</span><span class="n">columns</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="issue-3-scale-differences">Issue 3: Scale Differences<a class="headerlink" href="#issue-3-scale-differences" title="Permanent link">&para;</a></h3>
<p><strong>Problem</strong>: Binding values not in 0-1 range</p>
<p><strong>Solution</strong>: Normalize appropriately:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># For ChIP-seq peak heights</span>
<span class="n">binding_normalized</span> <span class="o">=</span> <span class="n">binding_df</span> <span class="o">/</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># For count data</span>
<span class="n">binding_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">binding_df</span> <span class="o">-</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">binding_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="c1"># For already-processed scores</span>
<span class="n">binding_clipped</span> <span class="o">=</span> <span class="n">binding_df</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>This comprehensive guide should help you prepare properly formatted input data for tfbpmodeling analysis.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../advanced-features/" class="btn btn-neutral float-left" title="Advanced Features"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../api/interface/" class="btn btn-neutral float-right" title="interface">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/brentlab/tfbpmodeling" class="fa fa-code-fork" style="color: #fcfcfc"> tfbpmodeling</a>
        </span>
    
    
      <span><a href="../advanced-features/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../api/interface/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
      <script src="../../js/mermaid-init.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
